<!DOCTYPE html>
<html ng-app="myApp">
<head>
  <meta charset="UTF-8">
  <title>ProductsController</title>
   <script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js'/></script>

  <script>
    var myAppModule = angular.module('myApp', [])

    myAppModule.factory("productFactory", function(){
      var factory = {};
      var products = [];
      factory.findProducts = function(callback){
        callback(products)
      }
      return factory;
    })
    //create User controller 
    myAppModule.controller("productsController", function($scope, productFactory){
      $scope.products = [];
      productFactory.findProducts(function(products){
        $scope.products = products; 
      })
      $scope.id = 0;

      $scope.addProduct = function(){
       $scope.newProduct.id = $scope.id; 
       $scope.newProduct.qty = 50; 
       $scope.products.push($scope.newProduct);
       $scope.id ++
       $scope.newProduct = null;

      };

      $scope.removeProduct = function(product){ 
        var index = $scope.products.indexOf(product)
        $scope.products.splice(index , 1 )
      }

    })

    myAppModule.controller("ordersController", function($scope, productFactory){
      $scope.products = [];
      console.log("hi")
      productFactory.findProducts(function(products){
        $scope.products = products;
        console.log($scope.products);
        console.log("yo")
      })

      $scope.buyProduct = function(product){
        if(typeof product.qty =='string'){

        }
       else{
         product.qty -- ;
       }
        if(product.qty < 0 ){
          product.qty = "sold out";
        }

      }

    })


  </script>
</head>
<body>
<h2>Product dashboard manager, 2 controllers </h2>
  <div ng-controller="productsController">
    <form >
      <input type="text" ng-model="newProduct.name" placeholder="Product">
      <input type="number" class="currency" min="0.01" max="2500.00" value="25.00" ng-model="newProduct.price"/>
      <input type="submit" value="addProduct" ng-click="addProduct()">
    </form>
    <table>
      <tr>
        <td>Product</td>
        <td>Price($)</td>
        <td>Remove</td>
      </tr>
      <tr id= "products_table" ng-repeat="product in products track by $index">
        <td>{{product.name}}</td>
        <td>{{product.price}}</td>
        <td><button ng-click="removeProduct(product)">Remove</button></td>
      </tr>

    </table>
  </div>
  <div ng-controller="ordersController">
    <table>
      <tr>
        <td>Product</td>
        <td>Price($)</td>
        <td>Qty</td>
        <td>Action</td>
      </tr>
      <tr id= "products_table" ng-repeat="product in products track by $index">
        <td>{{product.name}}</td>
        <td>{{product.price}}</td>
        <td>{{product.qty}}</td>
        <td><button ng-click="buyProduct(product)">buy</button></td>
      </tr>

    </table>




  </div>
</body>
</html>